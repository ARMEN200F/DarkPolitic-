<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Статьи</title>
<style>
body { font-family: Arial; background:#111; color:#eee; padding:20px }
button { padding:10px; margin:5px; cursor:pointer }
input, textarea { width:100%; margin:5px 0; padding:8px }
.post { border:1px solid #444; padding:10px; margin:10px 0 }
.hidden { display:none }
</style>
</head>
<body>

<h1 id="title">Добро пожаловать</h1>

<div id="login">
  <button id="btnAuthor">Войти как автор</button>
  <button id="btnUser">Войти как обычный пользователь</button>
</div>

<div id="authorPanel" class="hidden">
  <h2>Новая статья</h2>
  <input id="postTitle" placeholder="Заголовок">
  <textarea id="postText" placeholder="Текст статьи"></textarea>
  <button id="publishBtn">Опубликовать</button>
</div>

<h2>Статьи</h2>
<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  deleteDoc,
  doc,
  query,
  orderBy
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBAixfevL-T7BFz2iLb4jS1vcQ3nJBACuU",
  authDomain: "rson-2005b.firebaseapp.com",
  projectId: "rson-2005b",
  storageBucket: "rson-2005b.firebasestorage.app",
  messagingSenderId: "1026695255902",
  appId: "1:1026695255902:web:5858543731ca7b44ace1cf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let isAuthor = false;

const postsDiv = document.getElementById("posts");
const authorPanel = document.getElementById("authorPanel");

document.getElementById("btnAuthor").onclick = () => {
  const code = prompt("Введите код автора:");
  if (code === "120812") {
    isAuthor = true;
    authorPanel.classList.remove("hidden");
    document.getElementById("login").classList.add("hidden");
    document.getElementById("title").innerText = "Режим автора";
    renderPosts();
  } else {
    alert("Неверный код");
  }
};

document.getElementById("btnUser").onclick = () => {
  isAuthor = false;
  document.getElementById("login").classList.add("hidden");
  document.getElementById("title").innerText = "Режим пользователя";
  renderPosts();
};

document.getElementById("publishBtn").onclick = async () => {
  const title = postTitle.value.trim();
  const text = postText.value.trim();
  if (!title || !text) return alert("Заполни всё");

  await addDoc(collection(db, "posts"), {
    title,
    text,
    time: Date.now()
  });

  postTitle.value = "";
  postText.value = "";
};

function renderPosts() {
  const q = query(collection(db, "posts"), orderBy("time", "desc"));
  onSnapshot(q, snap => {
    postsDiv.innerHTML = "";
    snap.forEach(d => {
      const p = d.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `<h3>${p.title}</h3><p>${p.text}</p>`;

      if (isAuthor) {
        const btn = document.createElement("button");
        btn.innerText = "Удалить";
        btn.onclick = () => deleteDoc(doc(db, "posts", d.id));
        div.appendChild(btn);
      }

      postsDiv.appendChild(div);
    });
  });
}

renderPosts();
</script>

</body>
</html>